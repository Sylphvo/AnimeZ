(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9304],{388:(e,t,r)=>{Promise.resolve().then(r.bind(r,4034))},4034:(e,t,r)=>{"use strict";r.d(t,{default:()=>p});var n=r(5155),a=r(2115),o=r(1991),s=r(7558),i=r(3264);async function c(e,t,n){let{GLTFLoader:a}=await r.e(9311).then(r.bind(r,9311)),o=new a,s=await o.loadAsync("/models/Duck.gltf"),c=s.scene||new i.YJl;c.position.copy(t),c.scale.set(.5,.5,.5),c.traverse(e=>{if(e.isMesh){e.castShadow=!0,e.receiveShadow=!0;try{if(!(e.material instanceof i._4j)){let t=e.material,r=new i._4j({map:t.map||null,color:t.color||new i.Q1f(0xffffff)});r.skinning=!!e.skinned,e.material=r}}catch(e){}}}),e.add(c);let l={group:c};if(s.animations&&s.animations.length>0){let e=new i.Iw4(c),t=new Map;for(let r of s.animations){let n=r.name||r.uuid,a=e.clipAction(r);a.clampWhenFinished=!0,a.enabled=!0,t.set(n,a)}l.mixer=e,l.actions=t;let r=t.get("Idle")||t.get("idle")||t.values().next().value;r&&r.play()}return l}let l={playerRef:{current:new i.Pq0(0,1.6,0)}},d=(0,a.createContext)(l),u=e=>{let{children:t}=e,r=(0,a.useRef)(new i.Pq0(0,1.6,0));return(0,n.jsx)(d.Provider,{value:{playerRef:r},children:t})};function h(e){let{materials:t,thirdPerson:r,modelPath:n}=e,{camera:s,scene:l}=(0,o.C)(),{playerRef:u}=(0,a.useContext)(d),h=(0,a.useRef)(null),m=(0,a.useRef)(null),w=(0,a.useRef)(null);(0,a.useRef)(new i.zD7);let f=(0,a.useRef)({forward:!1,backward:!1,left:!1,right:!1,shift:!1,jump:!1}),p=(0,a.useRef)({phi:0,theta:0});return(0,a.useEffect)(()=>{let e=()=>{var e;let t=document.getElementById("root-canvas")||document.body;null==(e=t.requestPointerLock)||e.call(t)};return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]),(0,a.useEffect)(()=>{let e=e=>{switch(e.code){case"KeyW":case"ArrowUp":f.current.forward=!0;break;case"KeyS":case"ArrowDown":f.current.backward=!0;break;case"KeyA":case"ArrowLeft":f.current.left=!0;break;case"KeyD":case"ArrowRight":f.current.right=!0;break;case"ShiftLeft":case"ShiftRight":f.current.shift=!0;break;case"Space":f.current.jump=!0}},t=e=>{switch(e.code){case"KeyW":case"ArrowUp":f.current.forward=!1;break;case"KeyS":case"ArrowDown":f.current.backward=!1;break;case"KeyA":case"ArrowLeft":f.current.left=!1;break;case"KeyD":case"ArrowRight":f.current.right=!1;break;case"ShiftLeft":case"ShiftRight":f.current.shift=!1;break;case"Space":f.current.jump=!1}};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),(0,a.useEffect)(()=>{let e=e=>{document.pointerLockElement&&(p.current.theta-=.002*e.movementX,p.current.phi-=.002*e.movementY,p.current.phi=Math.max(-Math.PI/2,Math.min(Math.PI/2,p.current.phi)))};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[]),(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{if(h.current){try{l.remove(h.current)}catch(e){}h.current=null}let t=await c(l,u.current.clone(),n?"/models/character.glb":"/models/Duck.gltf");if(!e)return;h.current=t.group,h.current.scale.set(.5,.5,.5),t.mixer&&(m.current=t.mixer),t.actions&&(w.current=t.actions),h.current&&(h.current.visible=r)}catch(s){console.error("[SceneContent] loadCharacter failed",n,s);let e=new i.YJl,t=new i.iNn(.6,1.6,.4),a=new i._4j({color:0x996644}),o=new i.eaF(t,a);o.castShadow=!0,o.position.set(0,.8,0),e.add(o),e.position.copy(u.current),l.add(e),h.current=e,h.current.visible=r}})(),()=>{e=!1}},[l,n,r]),(0,o.D)((e,t)=>{m.current&&m.current.update(t);let n=f.current.shift?4*t:2*t,a=new i.Pq0;s.getWorldDirection(a),a.y=0,a.normalize();let o=new i.Pq0().crossVectors(a,new i.Pq0(0,1,0)).normalize(),c=new i.Pq0;if(f.current.forward&&c.add(a),f.current.backward&&c.add(a.clone().negate()),f.current.left&&c.add(o.clone().negate()),f.current.right&&c.add(o),c.normalize(),c.length()>0&&u.current.addScaledVector(c,n),r){let e=new i.Pq0(0,0,1).applyEuler(new i.O9p(0,p.current.theta,0)),t=u.current.clone().addScaledVector(e.normalize(),3);t.y=u.current.y+1.6,s.position.lerp(t,.15),s.lookAt(u.current.x,u.current.y+1,u.current.z),h.current&&(h.current.visible=!0)}else s.position.copy(u.current),s.position.y=1.6,s.rotation.order="YXZ",s.rotation.x=p.current.phi,s.rotation.y=p.current.theta,s.rotation.z=0,h.current&&(h.current.visible=!1);if(h.current){let e=h.current,t=new i.Pq0(u.current.x,0,u.current.z);e.position.lerp(t,.2),c.length()>0?e.rotation.y=Math.atan2(c.x,c.z):e.rotation.y=p.current.theta}}),null}function m(e){var t;let{materials:r}=e;return(0,n.jsxs)("mesh",{"rotation-x":-Math.PI/2,receiveShadow:!0,position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[100,100]}),(0,n.jsx)("meshStandardMaterial",{color:(null==(t=r.mossyGrass)?void 0:t.color)||7047995})]})}function w(e){let{materials:t,count:r=60,spread:o=50}=e,s=(0,a.useRef)([]);if(0===s.current.length)for(let e=0;e<r;e++)s.current.push([(Math.random()-.5)*o*2,0,(Math.random()-.5)*o*2]);return(0,n.jsx)("group",{children:s.current.map((e,r)=>{var a,o,s;let i=.8+.8*Math.random();return(0,n.jsxs)("group",{position:e,scale:[i,i,i],"rotation-y":Math.random()*Math.PI*2,children:[(0,n.jsxs)("mesh",{position:[0,1,0],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[.18,.25,2,8]}),(0,n.jsx)("meshStandardMaterial",{color:(null==(a=t.trunk)?void 0:a.color)||4865064})]}),(0,n.jsxs)("mesh",{position:[0,2.2,0],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("coneGeometry",{args:[1.2,2,8]}),(0,n.jsx)("meshStandardMaterial",{color:(null==(o=t.teaPlant)?void 0:o.color)||2972199})]}),(0,n.jsxs)("mesh",{position:[0,3.05,0],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("coneGeometry",{args:[.8,1.4,8]}),(0,n.jsx)("meshStandardMaterial",{color:(null==(s=t.teaPlant)?void 0:s.color)||3828530})]})]},r)})})}function f(e){let{materials:t}=e,r=(0,a.useRef)(null),{camera:s}=(0,o.C)();(0,a.useEffect)(()=>{let e=r.current;return s.add(e),e.position.set(0,-.25,-.5),()=>{try{s.remove(e)}catch(e){}}},[s]);let c=t.wood||new i._4j({color:0xd1a17a});return(0,n.jsxs)("group",{ref:r,children:[(0,n.jsxs)("mesh",{position:[-.18,0,-.15],castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.18,.18,.5]}),(0,n.jsx)("meshStandardMaterial",{...c})]}),(0,n.jsxs)("mesh",{position:[-.18,-.12,-.4],castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.14,.08,.2]}),(0,n.jsx)("meshStandardMaterial",{...c})]}),(0,n.jsxs)("mesh",{position:[.18,0,-.15],castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.18,.18,.5]}),(0,n.jsx)("meshStandardMaterial",{...c})]}),(0,n.jsxs)("mesh",{position:[.18,-.12,-.4],castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.14,.08,.2]}),(0,n.jsx)("meshStandardMaterial",{...c})]})]})}function p(){let e=(0,a.useMemo)(()=>(function(){let e=document.createElement("canvas");e.width=256,e.height=256;let t=e.getContext("2d");t.fillStyle="#3a5f3a",t.fillRect(0,0,256,256);for(let e=0;e<1e3;e++)t.fillStyle="hsl(".concat(80+20*Math.random(),", 50%, ").concat(30+20*Math.random(),"%)"),t.fillRect(256*Math.random(),256*Math.random(),1,1);let r=new i.GOR(e);return r.wrapS=i.GJx,r.wrapT=i.GJx,r.repeat.set(10,10),{grassTexture:r}})(),[]),t=(0,a.useMemo)(()=>({grass:new i.G_z({color:3825466,map:e.grassTexture}),mossyGrass:new i.G_z({color:4878154}),water:new i.tXL({color:4620980,shininess:100,transparent:!0,opacity:.8}),stone:new i.G_z({color:8421504}),wood:new i.G_z({color:9127187}),trunk:new i.G_z({color:4865064}),lantern:new i.tXL({color:0xff6b35,emissive:0xff6b35,emissiveIntensity:.2}),teaPlant:new i.G_z({color:2263842})}),[e]),[r,o]=(0,a.useState)(!0),[c,l]=(0,a.useState)(!1),[d]=(0,a.useState)(["characters.glb","Duck.gltf"]),[p,x]=(0,a.useState)(d[0]);return((0,a.useEffect)(()=>{o(!0)},[]),r)?(0,n.jsx)(u,{children:(0,n.jsxs)("div",{style:{width:"100%",height:"100vh",position:"relative"},children:[(0,n.jsxs)(s.Hl,{id:"root-canvas",shadows:!0,camera:{position:[0,1.6,0],fov:75},children:[(0,n.jsx)("ambientLight",{intensity:.6}),(0,n.jsx)("directionalLight",{position:[50,50,25],intensity:1,castShadow:!0}),(0,n.jsx)(h,{materials:t,thirdPerson:c,modelPath:p?"/models/".concat(p):void 0}),(0,n.jsx)(m,{materials:t}),(0,n.jsx)(w,{materials:t,count:80,spread:50}),!c&&(0,n.jsx)(f,{materials:t})]}),(0,n.jsxs)("div",{style:{position:"absolute",top:12,right:12,background:"rgba(0,0,0,0.5)",padding:8,borderRadius:6,color:"white"},children:[(0,n.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("input",{type:"checkbox",checked:c,onChange:()=>l(e=>!e)}),(0,n.jsx)("span",{style:{fontSize:12},children:"Third-person"})]}),(0,n.jsxs)("div",{style:{marginTop:8},children:[(0,n.jsx)("label",{style:{fontSize:12},children:"Character:"}),(0,n.jsxs)("select",{value:p,onChange:e=>{x(e.target.value)},style:{display:"block",marginTop:4},children:[(0,n.jsx)("option",{value:"",children:"(default)"}),d.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]})]})]})}):(0,n.jsx)("div",{style:{width:"100%",height:"100%"}})}}},e=>{var t=t=>e(e.s=t);e.O(0,[9367,1831,8413,3562,8441,1684,7358],()=>t(388)),_N_E=e.O()}]);